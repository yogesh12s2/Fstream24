<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ChadStreamz Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/x-icon" href="https://chadstreamz.sbs/favicon.svg"/>

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: Arial, sans-serif;
}
.player-container {
  position: relative;
  width: 100%;
  background: black;
}
#stream-media {
  width: 100%;
  height: 50vh;
  background: black;
  outline: none;
}
.watermark {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 80px;
  opacity: 0.7;
  pointer-events: none;
  z-index: 10;
}
.bottom-section {
  padding: 20px;
}
.download-btn {
  display: inline-block;
  padding: 12px 20px;
  background: #ff0000;
  color: #fff;
  text-decoration: none;
  font-size: 16px;
  font-weight: bold;
  border-radius: 6px;
  transition: 0.3s;
}
.download-btn:hover {
  background: #cc0000;
}
.suggestions {
  margin-top: 30px;
}
.suggestions h2 {
  font-size: 22px;
  margin-bottom: 20px;
}
.movies-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 18px;
}
.movie-card {
  cursor: pointer;
  transition: transform 0.3s;
}
.movie-card:hover {
  transform: scale(1.05);
}
.movie-card img {
  width: 100%;
  border-radius: 8px;
  display: block;
  box-shadow: 0 4px 8px rgba(0,0,0,0.5);
}
.movie-title {
  margin-top: 8px;
  font-size: 14px;
  text-align: center;
  color: #ccc;
}
@media(max-width:768px){
  .movie-title { font-size: 12px; }
  .download-btn { font-size: 14px; padding: 10px 16px; }
}
</style>
</head>

<body>

<div class="player-container">
  <video id="stream-media" controls preload="auto" poster="https://chadstreamz.sbs/assets/images/log2.png" autoplay>
    <source src="{{ mediaLink }}" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <img src="https://chadstreamz.sbs/assets/images/log2.png" class="watermark" alt="Watermark">
</div>

<div class="bottom-section">
  <a id="download-btn" class="download-btn">â¬‡ Download</a>

  <div class="suggestions">
    <h2>More Like This</h2>
    <div class="movies-grid" id="suggestion-container"></div>
  </div>
</div>

<script>
const mediaLink = "{{ mediaLink }}" || "https://example.com/video.mp4";
const video = document.getElementById('stream-media');
const downloadBtn = document.getElementById('download-btn');

// Set video source
video.src = mediaLink;
downloadBtn.href = mediaLink;
downloadBtn.setAttribute("download", "");

// --- Watch history using localStorage ---
const storageKey = "video_time_" + encodeURIComponent(mediaLink);

// Resume playback
video.addEventListener('loadedmetadata', () => {
  const savedTime = parseFloat(localStorage.getItem(storageKey));
  if (savedTime && !isNaN(savedTime) && savedTime < video.duration - 3) {
    video.currentTime = savedTime;
  }
});

// Save every 5 seconds
setInterval(() => {
  if (!video.paused && video.currentTime > 0) {
    localStorage.setItem(storageKey, video.currentTime);
  }
}, 5000);

window.addEventListener('beforeunload', () => {
  localStorage.setItem(storageKey, video.currentTime);
});


// ============================================
// ðŸ”¥ LOAD MOVIES FROM PHP API
// ============================================
const API_URL = "https://chadstreamz.sbs/api/random_movies.php";

async function loadSuggestions() {
  try {
    const response = await fetch(API_URL);
    const movies = await response.json();

    const container = document.getElementById('suggestion-container');
    container.innerHTML = "";

    movies.forEach(m => {
      const card = document.createElement("div");
      card.classList.add("movie-card");

      // Clicking loads movie download link
      card.onclick = () => {
        if (m.download) {
          window.location.href = m.download;
        }
      };

      card.innerHTML = `
        <img src="${m.image_url}" alt="${m.title}">
        <div class="movie-title">${m.title}</div>
      `;

      container.appendChild(card);
    });

  } catch (error) {
    console.log("Suggestion Load Error:", error);
  }
}



loadSuggestions();
</script>

</body>
</html>
