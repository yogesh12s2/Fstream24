<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ChadStreamz Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: Arial, sans-serif;
}
.player-container {
  position: relative;
  width: 100%;
  background: black;
}
#stream-media {
  width: 100%;
  height: 50vh;
  background: black;
  outline: none;
}
.watermark {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 80px;
  opacity: 0.7;
  pointer-events: none;
  z-index: 10;
}
.subtitle-btn {
  margin-top:10px;
  position: absolute;
  display:none;
  bottom: 15px;
  right: 20px;
  background: rgba(0,0,0,0.6);
  color: #fff;
  border: 1px solid #fff;
  border-radius: 4px;
  padding: 6px 10px;
  cursor: pointer;
  font-size: 14px;
  z-index: 11;
  transition: 0.3s;
}
.subtitle-btn:hover {
  background: #ff0000;
  border-color: #ff0000;
}
.bottom-section {
  padding: 20px;
}
.download-btn {
  display: inline-block;
  padding: 12px 20px;
  background: #ff0000;
  color: #fff;
  text-decoration: none;
  font-size: 16px;
  font-weight: bold;
  border-radius: 6px;
  transition: 0.3s;
}
.download-btn:hover {
  background: #cc0000;
}
.suggestions {
  margin-top: 30px;
}
.suggestions h2 {
  font-size: 22px;
  margin-bottom: 20px;
}
.movies-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 18px;
}
.movie-card {
  cursor: pointer;
  transition: transform 0.3s;
}
.movie-card:hover {
  transform: scale(1.05);
}
.movie-card img {
  width: 100%;
  border-radius: 8px;
  display: block;
  box-shadow: 0 4px 8px rgba(0,0,0,0.5);
}
.movie-title {
  margin-top: 8px;
  font-size: 14px;
  text-align: center;
  color: #ccc;
}
@media(max-width:768px){
  .movie-title { font-size: 12px; }
  .download-btn { font-size: 14px; padding: 10px 16px; }
}
</style>
</head>

<body>

<div class="player-container">
  <video id="stream-media" controls preload="auto" poster="https://chadstreamz.sbs/assets/images/log2.png">
    <source src="{{ mediaLink }}" type="video/mp4">
    <!-- Subtitle example -->
    <track id="subtitle-track" label="English" kind="subtitles" srclang="en" src="{{ subtitleLink }}" default>
    Your browser does not support the video tag.
  </video>

  <img src="https://chadstreamz.sbs/assets/images/log2.png" class="watermark" alt="Watermark">

  <!-- Subtitle toggle button -->
  <button id="toggle-subs" class="subtitle-btn">Subtitles: ON</button>
</div>

<div class="bottom-section">
  <a id="download-btn" class="download-btn">â¬‡ Download</a>
  <div class="suggestions">
    <h2>More Like This</h2>
    <div class="movies-grid">
      <div class="movie-card" onclick="window.location.href='https://chadstreamz.sbs'">
        <img src="https://image.tmdb.org/t/p/w500/weVXMD5QBGeQil4HEATZqAkXeEc.jpg" alt="Terminator">
        <div class="movie-title">Terminator</div>
      </div>
      <div class="movie-card" onclick="window.location.href='https://chadstreamz.sbs'">
        <img src="https://image.tmdb.org/t/p/w500/1g0dhYtq4irTY1GPXvft6k4YLjm.jpg" alt="Spiderman No Way Home">
        <div class="movie-title">Spiderman No Way Home</div>
      </div>
      <div class="movie-card" onclick="window.location.href='https://chadstreamz.sbs'">
        <img src="https://image.tmdb.org/t/p/w500/nAU74GmpUk7t5iklEp3bufwDq4n.jpg" alt="A Quiet Place">
        <div class="movie-title">A Quiet Place</div>
      </div>
    </div>
  </div>
</div>

<script>
const mediaLink = "{{ mediaLink }}" || "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8";
const subtitleLink = "{{ subtitleLink }}" || "https://example.com/subtitles.vtt"; // <-- Change this to your subtitle .vtt file
const video = document.getElementById('stream-media');
const downloadBtn = document.getElementById('download-btn');
const toggleBtn = document.getElementById('toggle-subs');
const track = document.getElementById('subtitle-track');

// Set sources
video.src = mediaLink;
if (subtitleLink) track.src = subtitleLink;
downloadBtn.href = mediaLink;
downloadBtn.setAttribute("download", "");

// --- Permanent watch history using localStorage ---
const storageKey = "video_time_" + encodeURIComponent(mediaLink);

// Resume playback
video.addEventListener('loadedmetadata', () => {
  const savedTime = parseFloat(localStorage.getItem(storageKey));
  if (savedTime && !isNaN(savedTime) && savedTime < video.duration - 3) {
    video.currentTime = savedTime;
  }
});

// Save progress every 5s
setInterval(() => {
  if (!video.paused && video.currentTime > 0) {
    localStorage.setItem(storageKey, video.currentTime);
  }
}, 5000);

// Save when leaving page
window.addEventListener('beforeunload', () => {
  localStorage.setItem(storageKey, video.currentTime);
});

// --- Subtitles toggle ---
toggleBtn.addEventListener('click', () => {
  if (track.mode === 'showing') {
    track.mode = 'hidden';
    toggleBtn.textContent = "Subtitles: OFF";
  } else {
    track.mode = 'showing';
    toggleBtn.textContent = "Subtitles: ON";
  }
});

// Default subtitles ON
video.textTracks[0].mode = 'showing';

// --- HLS support ---
if (mediaLink.endsWith('.m3u8') && video.canPlayType('application/vnd.apple.mpegurl')) {
  video.src = mediaLink;
} else if (mediaLink.endsWith('.m3u8')) {
  const script = document.createElement('script');
  script.src = "https://cdn.jsdelivr.net/npm/hls.js@latest";
  script.onload = () => {
    if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(mediaLink);
      hls.attachMedia(video);
    }
  };
  document.body.appendChild(script);
}
</script>

</body>
</html>

