<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ChadStreamz Player</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Plyr CSS (player chrome) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@4.1.8/dist/plyr.css" />
  <style>
    :root{--bg:#000;--muted:#ccc;--accent:#ff0000}
    body{
      margin:0;
      background:var(--bg);
      color:#fff;
      font-family:Arial, Helvetica, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    /* player container */
    .player-container{
      position:relative;
      width:100%;
      background:#000;
      max-width:1200px;
      margin: 0 auto;
    }
    /* Plyr video will fill the container */
    .plyr__video-embed, video, .plyr {
      width:100%;
      max-height:70vh;
      background:#000;
      border-radius:6px;
      display:block;
    }
    /* watermark */
    .watermark{
      position:absolute;
      top:12px;
      right:12px;
      width:80px;
      opacity:0.8;
      pointer-events:none;
      z-index:20;
    }
    /* bottom section */
    .bottom-section{
      max-width:1200px;
      margin:18px auto;
      padding:0 16px 40px;
    }
    .actions{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:18px;
    }
    .download-btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:12px 18px;
      background:var(--accent);
      color:#fff;
      text-decoration:none;
      font-size:16px;
      font-weight:700;
      border-radius:8px;
      transition:transform .15s ease, background .15s;
      border:0;
    }
    .download-btn:hover{ transform:translateY(-2px) }
    .open-btn{
      display:inline-flex;
      padding:10px 14px;
      background:transparent;
      color:#fff;
      border:1px solid rgba(255,255,255,0.08);
      border-radius:8px;
      text-decoration:none;
      font-size:14px;
    }
    /* suggestions grid */
    .suggestions h2{
      font-size:22px;
      margin:6px 0 14px 0;
      color:#fff;
    }
    .movies-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
      gap:18px;
    }
    .movie-card{
      cursor:pointer;
      transition:transform .22s ease, box-shadow .22s ease;
      will-change:transform;
    }
    .movie-card:hover{
      transform:translateY(-6px) scale(1.02);
      box-shadow:0 8px 22px rgba(0,0,0,0.7);
    }
    .movie-card img{
      width:100%;
      border-radius:8px;
      display:block;
      height:240px;
      object-fit:cover;
      background:#111;
      box-shadow:0 6px 14px rgba(0,0,0,0.6);
    }
    .movie-title{
      margin-top:8px;
      font-size:14px;
      text-align:center;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    @media(max-width:768px){
      .movie-title{ font-size:12px }
      .download-btn{ font-size:14px; padding:10px 14px; }
      .movie-card img { height:160px; }
    }
    /* small helper text */
    .info{
      color:#bdbdbd;
      font-size:13px;
      margin-left:6px;
    }
  </style>
</head>
<body>

  <!-- Player -->
  <div class="player-container" id="player-wrap">
    <!-- Use a simple <video> tag; Plyr will enhance it -->
    <video id="stream-media" playsinline controls crossorigin="anonymous" preload="auto"></video>
    <img src="https://chadstreamz.sbs/assets/images/log2.png" class="watermark" alt="Watermark">
  </div>

  <!-- Bottom Section -->
  <div class="bottom-section">
    <div class="actions">
      <a id="download-btn" class="download-btn" href="#" role="button" aria-disabled="true">⬇ Download</a>
      <a id="open-btn" class="open-btn" href="#" target="_blank" rel="noopener">Open stream in new tab</a>
      <span id="stream-info" class="info"></span>
    </div>

    <!-- Movie Suggestions Grid -->
    <div class="suggestions">
      <h2>More Like This</h2>
      <div class="movies-grid">
        <div class="movie-card" onclick="window.location.href='https://chadstreamz.sbs'">
          <img src="https://image.tmdb.org/t/p/w500/weVXMD5QBGeQil4HEATZqAkXeEc.jpg" alt="Terminator">
          <div class="movie-title">Terminator</div>
        </div>
        <div class="movie-card" onclick="window.location.href='https://chadstreamz.sbs'">
          <img src="https://image.tmdb.org/t/p/w500/1g0dhYtq4irTY1GPXvft6k4YLjm.jpg" alt="Spiderman">
          <div class="movie-title">Spiderman No Way Home</div>
        </div>
        <div class="movie-card" onclick="window.location.href='https://chadstreamz.sbs'">
          <img src="https://image.tmdb.org/t/p/w500/nAU74GmpUk7t5iklEp3bufwDq4n.jpg" alt="A Quiet Place">
          <div class="movie-title">A Quiet Place</div>
        </div>
        <div class="movie-card" onclick="window.location.href='https://chadstreamz.sbs'">
          <img src="https://image.tmdb.org/t/p/w500/q719jXXEzOoYaps6babgKnONONX.jpg" alt="Your Name">
          <div class="movie-title">Your Name</div>
        </div>
        <div class="movie-card" onclick="window.location.href='https://chadstreamz.sbs'">
          <img src="https://image.tmdb.org/t/p/w500/rJHC1RUORuUhtfNb4Npclx0xnOf.jpg" alt="Uncharted">
          <div class="movie-title">Uncharted</div>
        </div>
        <div class="movie-card" onclick="window.location.href='https://chadstreamz.sbs'">
          <img src="https://image.tmdb.org/t/p/w1280/gEU2QniE6E77NI6lCU6MxlNBvIx.jpg" alt="Interstellar">
          <div class="movie-title">Interstellar</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Plyr + hls.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.8/dist/hls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/plyr@4.1.8/dist/plyr.polyfilled.js"></script>

  <script>
    (function(){
      // === Replace this with your stream. If rendering server-side use: "{{ mediaLink }}"
      // Examples:
      // var mediaLink = "https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/720/Big_Buck_Bunny_720_10s_1MB.mp4";
      // var mediaLink = "https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8";
      var mediaLink = "{{ mediaLink }}"; // <-- replace server-side or set directly here for testing

      // Elements
      var video = document.getElementById('stream-media');
      var downloadBtn = document.getElementById('download-btn');
      var openBtn = document.getElementById('open-btn');
      var info = document.getElementById('stream-info');

      // Utility: check if link looks like HLS
      function isHls(url){
        if(!url) return false;
        var lower = url.toLowerCase();
        return lower.indexOf('.m3u8') !== -1 || lower.indexOf('.m3u8?') !== -1;
      }

      // Initialize plyr after setting source
      function initPlyr(){
        // Use plyr to style controls
        const player = new Plyr(video, {
          controls: ['play-large','play','progress','current-time','mute','volume','settings','pip','airplay','fullscreen'],
          settings: ['quality','speed'],
          clickToPlay: true,
          seekTime: 10
        });

        // Expose to window for debugging/testing
        window.chadPlayer = player;
      }

      function setStream(src){
        if(!src || src === "{{ mediaLink }}"){
          info.textContent = 'No media URL provided — replace `mediaLink` with a valid stream (mp4 or .m3u8).';
          disableButtons();
          return;
        }

        // If HLS
        if(isHls(src)){
          info.textContent = 'Playing HLS stream (.m3u8). Downloading HLS playlists directly is not supported by browsers.';
          // Some browsers (Safari on macOS/iOS) play HLS natively with the video element.
          if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = src;
            video.type = 'application/vnd.apple.mpegurl';
            initPlyr();
          } else if (Hls.isSupported()) {
            // use hls.js
            var hls = new Hls({
              // Auto start level for adaptive streaming
              // debug: true
            });
            hls.loadSource(src);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
              initPlyr();
            });
            // optional: handle errors
            hls.on(Hls.Events.ERROR, function(event, data){
              console.warn('HLS error', data);
              if (data.fatal) {
                switch (data.type) {
                  case Hls.ErrorTypes.NETWORK_ERROR:
                    info.textContent = 'Network error while loading stream.';
                    hls.startLoad();
                    break;
                  case Hls.ErrorTypes.MEDIA_ERROR:
                    info.textContent = 'Media error — attempting recover.';
                    hls.recoverMediaError();
                    break;
                  default:
                    info.textContent = 'Error playing stream.';
                    hls.destroy();
                    break;
                }
              }
            });
          } else {
            info.textContent = 'Your browser does not support HLS playback.';
            disableButtons();
            return;
          }

          // For HLS, openBtn should open the playlist in a new tab; download not enabled
          openBtn.href = src;
          downloadBtn.removeAttribute('download');
          downloadBtn.href = src;
          downloadBtn.setAttribute('aria-disabled','true');
          downloadBtn.style.opacity = '0.8';
          downloadBtn.style.pointerEvents = 'auto';
          downloadBtn.textContent = 'Open HLS';
        } else {
          // Treat as direct playable file (mp4, webm, etc.)
          video.src = src;
          video.type = ''; // browser will infer
          initPlyr();

          // Enable download
          downloadBtn.href = src;
          downloadBtn.setAttribute('download','');
          downloadBtn.setAttribute('aria-disabled','false');
          downloadBtn.textContent = '⬇ Download';
          openBtn.href = src;
          info.textContent = 'Direct file detected — you can download or play.';
        }
      }

      function disableButtons(){
        downloadBtn.href = '#';
        openBtn.href = '#';
        downloadBtn.setAttribute('aria-disabled','true');
        downloadBtn.style.opacity = '0.6';
        downloadBtn.style.pointerEvents = 'none';
      }

      // Try to set stream now
      setStream(mediaLink && mediaLink.trim() ? mediaLink.trim() : '');

      // Small UX: if download is clicked for HLS, open in new tab
      downloadBtn.addEventListener('click', function(e){
        var href = downloadBtn.getAttribute('href') || '';
        if(!href || href === '#'){
          e.preventDefault();
          return;
        }
        if(isHls(href)){
          // open in a new tab (download not possible)
          window.open(href, '_blank', 'noopener');
          e.preventDefault();
        } // else browser will attempt download
      });

      // Prevent right click on watermark (optional)
      document.querySelector('.watermark').addEventListener('contextmenu', function(e){
        e.preventDefault();
      });
    })();
  </script>
</body>
</html>
